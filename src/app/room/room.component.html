<app-story *ngIf="data.room.story" [room]="data.room" [user]="data.user"></app-story>
<div id="topmsg" class="msg"><span *ngIf="mentionTop" (click)="noticeClick('mentionTop')" class="mention">メンション↑{{mentionTop}}件</span></div>
<ion-content [class.none]="!data.room.chat" id="chatscontent" #chatscontent [scrollEvents]="true" (ionScroll)="onScroll($event)"
  (ionScrollEnd)="onScrollEnd($event)">
  <ion-infinite-scroll #top position="top" threshold="10px" (ionInfinite)="chatLoad($event,'top')">
    <ion-infinite-scroll-content loadingSpinner="bubbles">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
  <div><span style="color:lightgrey">{{topMsg}}</span></div>
  <ion-list>
    <ion-item class="chat" *ngFor="let chat of chats.reverse();index as i" [class.readed]="chat.readed">
      <span style="display:none;">{{chat.upd.toDate() | date:'MMM d, y, H:mm:ss:SSS'}}</span>
      <span style="display:none;">{{i}}</span>
      <ion-item button="true" (click)="popMember($event)">
        <ion-avatar class="avatar" item-start>
          <ion-img [src]="chat.avatar"></ion-img>
        </ion-avatar>
      </ion-item>
      <div><span class="chatna">{{chat.na}}</span>
        <span class="chatdate"> {{chat.upd.toDate() | date:'short'}}</span>
        <span class="chatdate" *ngIf="chat.rev"> {{chat.rev.toDate() | date:'short'}}修正</span>
        <span *ngIf="chat.uid === data.user.id || data.room.auth >=200" slot="end">
          <ion-button slot="icon-only" (click)="edit($event)" color="light">
            <ion-icon name="brush"></ion-icon>
          </ion-button>
          <ion-button slot="icon-only" (click)="delete($event)" color="light">
            <ion-icon name="trash"></ion-icon>
          </ion-button>
        </span>
        <div class="chattxt" [innerHtml]="chat.txt | safe: 'html'"></div>
      </div>
    </ion-item>
  </ion-list>
  <div (click)="btmClick()"><span style="color:lightgrey">{{btmMsg}}</span></div>
  <ion-infinite-scroll #btm position="bottom" threshold="10px" (ionInfinite)="chatLoad($event,'btm')">
    <ion-infinite-scroll-content loadingSpinner="bubbles">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
<div id="btmmsg" class="msg"><span class="mention" *ngIf="mentionBtm" (click)="noticeClick('mentionBtm')">メンション↓{{mentionBtm}}件</span>
  <span class="newmsg" *ngIf="newUpds.length" (click)="noticeClick('newMsg')">新着メッセージ↓{{newUpds.length}}件</span></div>